# Training-specific parameters (split from default.yaml)
# num_epochs: 50  # Deprecated: Use max_steps for step-based training instead

max_steps: 100000  # Maximum training steps


ema_rate_precision: 4  # Decimal places for EMA rate in filename
ema_rate: "0.9999"  # Comma-separated for multiple, e.g. "0.999,0.9999"

# Gradient techniques
gradient:
  clip_norm: 1.0  # Max gradient norm (null = disabled)
  clip_value: null  # Alternative: clip by value

# Interval-based checkpoints (for training resumption)
# Saves model + optimizer state at fixed step intervals for fault recovery
checkpoint_interval:
  enabled: true
  save_interval: 10000
  keep_last_n: 3  # Keep only last 3 interval checkpoints (null = keep all)
  model_template: 'models/checkpoint/diffusion_chkpt_step_{:06d}.pth'
  opt_template: 'models/checkpoint/opt_chkpt_step_{:06d}.pth'

# Metric-based best model checkpoints (for inference)
# Saves model + EMA when validation metric improves
checkpoint_best:
  enabled: true
  metric_name: "dice_2d_fg"  # Must match validation metric key (without "val_" prefix)
  metric_mode: "max"  # "max" (higher is better) or "min" (lower is better)
  keep_last_n: 3  # Keep only top 3 best models by metric value (null = keep all)
  model_template: 'models/best/best_model_step_{step:06d}_{metric_name}_{metric_value:.4f}.pth'
  ema_template: 'models/best/best_model_step_{step:06d}_{metric_name}_{metric_value:.4f}_ema_{rate}.pth'
